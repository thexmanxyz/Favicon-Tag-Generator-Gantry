{#######################################################}
{#                                                     #}
{#   Favicon Tag Generator - Extension for Gantry      #}
{#                                                     #}
{#   Purpose: This project improves the Favicon as     #}
{#            well as the Touch Icon Tag Generation    #}
{#            and Configuration within the Gantry      #}
{#            templating framework.                    #}
{#                                                     #}
{#   Author: Andreas Kar (thex) <andreas.kar@gmx.at>   #}
{#                                                     #}
{#######################################################}

{% extends '@nucleus/partials/particle.html.twig' %}

{% set general = particle.general %}

{% set base = general.base_path %}
{% set base = base ~ ((base ends with '/') ? '' : '/') %}
{% set base = base ~ general.file_id %}

{% set tileLink = base ~ '-' ~ '144.png' %}
{% if general.mode == 'manual' or (general.mode == 'semi-auto' and particle.icon144tile.image is not empty) %}
    {% set tileLink = particle.icon144tile.image %}
{% endif %}
        
{%- block head -%}
    {{ parent() }}
    {%- if general.mode != 'custom' -%}
        {{- _self.renderLinkTagMode(general.mode, particle.icon.enabled, particle.icon.rel, "image/x-icon", "", "", general.base_path, general.file_id, particle.icon.image) -}}
        {{- _self.renderLinkTagMode(general.mode, particle.icon57.enabled, particle.icon57.rel, "", "57", "57x75", general.base_path, general.file_id, particle.icon57.image) -}}
        {{- _self.renderLinkTagMode(general.mode, particle.icon60.enabled, particle.icon60.rel, "", "60", "60x60", general.base_path, general.file_id, particle.icon60.image) -}}
        {{- _self.renderLinkTagMode(general.mode, particle.icon72.enabled, particle.icon72.rel, "", "72", "72x72", general.base_path, general.file_id, particle.icon72.image) -}}
        {{- _self.renderLinkTagMode(general.mode, particle.icon76.enabled, particle.icon76.rel, "", "76", "76x76", general.base_path, general.file_id, particle.icon76.image) -}}
        {{- _self.renderLinkTagMode(general.mode, particle.icon114.enabled, particle.icon114.rel, "", "114", "114x114", general.base_path, general.file_id, particle.icon114.image) -}}
        {{- _self.renderLinkTagMode(general.mode, particle.icon120.enabled, particle.icon120.rel, "", "120", "120x120", general.base_path, general.file_id, particle.icon120.image) -}}
        {{- _self.renderLinkTagMode(general.mode, particle.icon144.enabled, particle.icon144.rel, "", "144", "144x144", general.base_path, general.file_id, particle.icon144.image) -}}
        {{- _self.renderLinkTagMode(general.mode, particle.icon152.enabled, particle.icon152.rel, "", "152", "152x152", general.base_path, general.file_id, particle.icon152.image) -}}
        {{- _self.renderLinkTagMode(general.mode, particle.icon180.enabled, particle.icon180.rel, "", "180", "180x180", general.base_path, general.file_id, particle.icon180.image) -}}
        
        {{- _self.renderLinkTagMode(general.mode, particle.icon16.enabled, particle.icon16.rel, "image/png", "16", "16x16", general.base_path, general.file_id, particle.icon16.image) -}}
        {{- _self.renderLinkTagMode(general.mode, particle.icon32.enabled, particle.icon32.rel, "image/png", "32", "32x32", general.base_path, general.file_id, particle.icon32.image) -}}
        {{- _self.renderLinkTagMode(general.mode, particle.icon96.enabled, particle.icon96.rel, "image/png", "96", "96x96", general.base_path, general.file_id, particle.icon96.image) -}}
        {{- _self.renderLinkTagMode(general.mode, particle.icon192.enabled, particle.icon192.rel, "image/png", "192", "192x192", general.base_path, general.file_id, particle.icon192.image) }}
        {{- _self.renderLinkTagMode(general.mode, particle.manifest.enabled, particle.manifest.rel, "", "", "", general.base_path, "manifest", particle.manifest.path) -}}
        
        {{- _self.renderMetaTag(particle.icon144tile.enabled, "msapplication-TileImager", url(tileLink)) -}}
        {{- _self.renderMetaTag(particle.tilecolor.enabled, "msapplication-TileColor", particle.tilecolor.color) -}}
        {{- _self.renderMetaTag(particle.themecolor.enabled, "theme-color", particle.themecolor.color) -}}
    {%- endif -%}
    
    {%- for cTag in particle.custom.tags -%}
        {{- _self.renderLinkTag(cTag.enabled, cTag.rel, cTag.type, cTag.sizes, cTag.image) -}}
    {%- endfor -%}
{%- endblock -%}

{%- macro renderLinkTagMode(mode, enabled, rel, type, size, sizes, basePath, fileId, hrefC) -%}
    {%- import _self as SELF -%}
    {%- if enabled -%}
        {%- set href = basePath -%}
        {%- set href = href ~ ((href ends with '/') ? '' : '/') -%}
        {%- set href = href ~ fileId -%}
        {%- if fileId != 'manifest' -%}
            {%- set href = href ~ ((size is not empty) ? '-' ~ size ~ '.png' : '.ico') -%}
        {%- else -%}
            {%- set href = href ~ ".json" -%}
        {%- endif -%}
        {%- if mode == 'manual' or (mode == 'semi-auto' and hrefC is not empty) -%}
            {%- set href = hrefC -%}
        {%- endif -%}
        {%- if href is not empty -%}
            {{ SELF.renderLinkTag(enabled, rel, type, sizes, href) }}
        {%- endif -%}
    {%- endif -%}
{%- endmacro -%}

{%- macro renderLinkTag(enabled, rel, type, sizes, href) -%}
    {%- if enabled -%}
        {%- set linkTag = '<link rel="' ~ rel|e ~ '"' -%}
        {%- if type is not empty -%}
            {%- set linkTag = linkTag ~ ' type="' ~ type|e ~ '"' -%}
        {%- endif -%}
        {%- if sizes is not empty -%}
            {%- set linkTag = linkTag ~ ' sizes="' ~ sizes|e ~ '"' -%}
        {%- endif -%}
        {%- if href is not empty -%}
            {%- set linkTag = linkTag ~ ' href="' ~ url(href) ~ '"' -%}
        {%- endif -%}
        {%- set linkTag = linkTag ~ '>' -%}
        {{- linkTag|raw -}}
    {% endif %}
{%- endmacro -%}

{%- macro renderMetaTag(enabled, name, content) -%}
    {%- if enabled -%}
        {%- set linkTag = '<meta name="' ~ name|e ~ '"' -%}
        {%- if content is not empty -%}
            {%- set linkTag = linkTag ~ ' content="' ~ content|e ~ '"' -%}
        {%- endif -%}
        {%- set linkTag = linkTag ~ '>' -%}
        {{- linkTag|raw -}}
    {% endif %}
{%- endmacro -%}